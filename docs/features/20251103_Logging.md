# Feature: Application Insights + Business Metrics Tracking

## Problem
Email functionality works but no error logs visible in Azure production. Cannot troubleshoot failed email sends or track business metrics.

## Solution
Implement Application Insights with comprehensive logging and custom business metrics.

## Implementation

### 1. Application Insights Integration
- **Package:** `Microsoft.ApplicationInsights.AspNetCore`
- **Configuration:** Program.cs + appsettings.json
- **Azure:** Connection string in App Settings

### 2. Logging Points
- **ConfiguratorFormPage.razor:**
  - Form submission start/success/failure
  - Customer email/phone (structured logging)
  - Email send results
  - Exception details with full context

- **Error.razor:**
  - Unhandled exceptions
  - Request context (TraceIdentifier)

- **Production log levels:**
  - Default: Information
  - Microsoft.AspNetCore: Warning
  - Custom telemetry for form flow

### 3. Business Metrics (Custom Telemetry)
- **Daily Inquiries:** Count of successful form submissions
- **Daily Revenue Potential:** Sum of price estimates
- **Tracked Properties:**
  - Customer email
  - Order value (CZK)
  - Dimensions (A, B, C)
  - Roof type
  - Timestamp

### 4. Azure Configuration Required
```
APPLICATIONINSIGHTS_CONNECTION_STRING=InstrumentationKey=...
Email__SmtpUsername=<username>
Email__SmtpPassword=<password> (use Key Vault)
```

## Benefits
- ✅ Persistent logs in Azure (queryable for 90 days default)
- ✅ Exception tracking with stack traces
- ✅ Business metrics dashboard (inquiries/day, revenue/day)
- ✅ Performance monitoring
- ✅ Email troubleshooting capability

## Querying Metrics (Azure Portal)
```kusto
// Daily inquiries
customEvents
| where name == "InquirySubmitted"
| summarize count() by bin(timestamp, 1d)

// Daily revenue potential
customMetrics
| where name == "OrderValue"
| summarize sum(value) by bin(timestamp, 1d)
``` 